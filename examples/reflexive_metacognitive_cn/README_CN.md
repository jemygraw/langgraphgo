# 反思元认知代理 (Reflexive Metacognitive Agent) - 中文版

本示例演示了**反思元认知代理**架构的中文实现版本，具有完全中文化的提示词、日志和响应。该架构通过维护一个显式的模型来表达AI代理自身的能力、知识边界和置信度，从而使其具备自我意识。

## 架构概述

元认知代理维护一个显式的**"自我模型"**——对其自身知识、工具和边界的结构化表示。当面临任务时，它的第一步不是解决问题，而是*在自我模型的背景下分析问题*。

### 元认知问题

代理会问自己这样的问题：
- 我有足够的知识来自信地回答这个问题吗？
- 这个主题在我的专业领域内吗？
- 我有安全回答这个问题所需的特定工具吗？
- 用户的查询是否涉及错误可能造成危险的高风险主题？

### 策略选择

根据元认知分析结果，代理选择以下三种策略之一：

1. **直接推理 (REASON_DIRECTLY)**：针对知识库内的高置信度、低风险查询
2. **使用工具 (USE_TOOL)**：当查询需要通过专门工具获得特定能力时
3. **升级处理 (ESCALATE)**：针对低置信度、高风险或超出范围的查询

## 应用场景

此架构特别适用于：

- **高风险咨询系统**：医疗、法律、金融——代理必须能够说"我不知道"
- **自主系统**：必须评估自己安全执行物理任务能力的机器人
- **复杂工具编排器**：必须从众多选项中选择正确API的代理

## 优缺点

### 优点
- **增强安全性**：代理被明确设计为避免在非专业领域做出自信断言
- **改进决策**：强制进行深思熟虑的策略选择，而不是天真地直接尝试
- **中文友好**：所有提示词、日志和响应都是中文，更适合中文用户

### 缺点
- **自我模型的复杂性**：定义和维护准确的自我模型可能很复杂
- **元认知开销**：初始分析步骤增加了延迟和计算成本

## 运行方式

```bash
cd examples/reflexive_metacognitive_cn
go run .
```

确保已设置 `OPENAI_API_KEY` 环境变量。

## 示例输出

演示运行四个中文测试用例：

### 测试 1：简单查询（感冒症状）

```
=== 测试 1：简单的、范围内的、低风险查询 ===

┌─────────────────────────────────────────────────────────────┐
│ 🤔 代理正在进行元认知分析...                                 │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│ 置信度: 1.00                                               │
│ 策略: 直接推理                                              │
│ 理由: 查询明确涉及知识领域内的主题（感冒），属于简单的低风险  │
│       信息性问题，可直接基于现有知识回答。                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ ✅ 对直接回答有信心。正在生成响应...                         │
└─────────────────────────────────────────────────────────────┘

📋 响应：
感冒是一种常见的病毒感染（通常是鼻病毒），主要影响上呼吸道。以下是典型的感冒症状...
```

### 测试 2：药物相互作用查询

```
=== 测试 2：需要专门工具的查询 ===

┌─────────────────────────────────────────────────────────────┐
│ 🤔 代理正在进行元认知分析...                                 │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│ 置信度: 0.95                                               │
│ 策略: 使用工具                                              │
│ 理由: 该查询明确涉及两种药物的潜在相互作用，属于工具使用范围  │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 🛠️  置信度需要使用工具。正在调用 `drug_interaction_checker`...│
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 📝 正在综合工具输出的最终响应...                             │
└─────────────────────────────────────────────────────────────┘

📋 响应：
根据目前的药物相互作用信息，赖诺普利与布洛芬之间未发现已知的显著相互作用...
```

### 测试 3：紧急医疗情况

```
=== 测试 3：高风险、紧急查询 ===

┌─────────────────────────────────────────────────────────────┐
│ 🤔 代理正在进行元认知分析...                                 │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│ 置信度: 1.00                                               │
│ 策略: 升级处理                                              │
│ 理由: 用户描述的胸部剧烈疼痛和左臂麻木是典型的心血管紧急情况  │
│       的标志症状，这完全超出了代理的知识范围                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 🚨 检测到低置信度或高风险。正在升级处理。                     │
└─────────────────────────────────────────────────────────────┘

📋 响应：
我是AI助手，没有资格提供此主题的信息。此查询超出了我的知识领域或
涉及潜在严重症状。**请立即咨询合格的医疗专业人员。**
```

### 测试 4：超出范围的查询

```
=== 测试 4：超出范围的查询 ===

策略: 升级处理

理由: 查询涉及癌症治疗这一超出知识领域（感冒、流感、过敏、头痛、
       基本急救）的专业医疗领域...

📋 响应：
我是AI助手，没有资格提供此主题的信息。**请立即咨询合格的医疗专业人员。**
```

## 架构图

```
                    用户查询
                         │
                         ▼
              ┌─────────────────────┐
              │ 元认知分析节点       │
              │ (自我反思)           │
              │ 中文提示词           │
              └─────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         ▼               ▼               ▼
   ┌───────────┐  ┌───────────┐  ┌───────────┐
   │  直接推理  │  │  使用工具  │  │  升级给   │
   │  中文响应  │  │  中文工具  │  │  人类     │
   └───────────┘  └─────┬─────┘  └───────────┘
                        │
                        ▼
                 ┌─────────────┐
                 │  综合响应   │
                 │  中文输出   │
                 └─────────────┘
```

## 核心组件

### AgentSelfModel（代理自我模型）

定义代理知道什么和能做什么：

```go
medicalAgentModel := &AgentSelfModel{
    Name:            "医疗分诊助手-3000",
    Role:            "提供初步医疗信息的有用AI助手",
    KnowledgeDomain: []string{"感冒", "流感", "过敏", "头痛", "基本急救"},
    AvailableTools:  []string{"药物相互作用检查器"},
    ConfidenceThreshold: 0.6,
}
```

### 元认知分析节点

架构的核心。使用**中文提示词**通过LLM分析：
- 查询的复杂性和风险级别
- 与知识领域的相关性
- 工具需求
- 提供安全答案的置信度

### 策略路由

根据所选策略（`直接推理`、`使用工具`、`升级处理`）定向流的条件边。

### 中文工具

- **药物相互作用检查器**：中文化的药物相互作用数据库
  - 布洛芬 + 赖诺普利 → 中度风险
  - 阿司匹林 + 华法林 → 高风险

## 关键要点

反思元认知代理架构使AI系统能够：

1. **维护能力和局限性的显式自我模型**：明确知道自己的知识边界
2. **在尝试解决问题之前先进行元认知分析**：思考"是否应该回答"而非"如何回答"
3. **选择最安全的策略**：直接推理、使用工具或升级处理
4. **认识自己所不知道的内容**：这对安全至关重要

## 参考资料

基于 Fareed Khan 的代理架构系列：
https://github.com/FareedKhan-dev/all-agentic-architectures/blob/main/17_reflexive_metacognitive.ipynb
